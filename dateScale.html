<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8" />
	<title></title>
</head>
<body>
	<div>
		<label>min</label>
		<input id="min" value="1428224701378" />
	</div>
	<div>
		<label>max</label>
		<input id="max" value="1428483926920" />
	</div>
	<div>
		<label>width</label>
		<input id="width" value="320" />
	</div>
	<div>
		<label>font size</label>
		<input id="fontSize" value="12" />
	</div>

	<a href="#" onclick=" return go() ">push me</a>

	<div id="result" style="margin-top: 42px; border-top: 1px dashed gray;">
	</div>

	<script>

		function go() {

			var min = document.getElementById("min").value;
			var max = document.getElementById("max").value;
			var width = document.getElementById("width").value;
			var fontSize = document.getElementById("fontSize").value;

			var result = calc(min, max, width, fontSize);

			var resultPanel = document.getElementById("result");

			resultPanel.innerHTML = new Date(+result.start).toLocaleString() + " - " + result.stepValue / 3600000 + "h - " + result.stepCount;

			var ul = document.createElement("ul");

			for (var i = 0; i < result.stepCount; i++) {

				var date = +result.start + (result.stepValue * i);
				var label = new Date(date).toLocaleString();
				var li = document.createElement("li");
				li.innerText = label;
				ul.appendChild(li);
			}

			resultPanel.appendChild(ul);

			return false;
		}

		function getElementOrDefault(array, index, defaultValue) {

			return index >= 0 && index < array.length ? array[index] : defaultValue;
		}

		function calc(valueMin, valueMax, drawingSize, fontSize) {

			var units = [
				{ u: 1, c: 1, t: 1, n: 'ms' },
				{ u: 1, c: 2, t: 2, n: 'ms' },
				{ u: 1, c: 5, t: 5, n: 'ms' },
				{ u: 1, c: 10, t: 10, n: 'ms' },
				{ u: 1, c: 20, t: 20, n: 'ms' },
				{ u: 1, c: 50, t: 50, n: 'ms' },
				{ u: 1, c: 100, t: 100, n: 'ms' },
				{ u: 1, c: 200, t: 200, n: 'ms' },
				{ u: 1, c: 500, t: 500, n: 'ms' },
				{ u: 1000, c: 1, t: 1000, n: 's' },
				{ u: 1000, c: 2, t: 2000, n: 's' },
				{ u: 1000, c: 5, t: 5000, n: 's' },
				{ u: 1000, c: 10, t: 10000, n: 's' },
				{ u: 1000, c: 15, t: 15000, n: 's' },
				{ u: 1000, c: 20, t: 20000, n: 's' },
				{ u: 1000, c: 30, t: 30000, n: 's' },
				{ u: 60000, c: 1, t: 60000, n: 'm' },
				{ u: 60000, c: 2, t: 120000, n: 'm' },
				{ u: 60000, c: 5, t: 300000, n: 'm' },
				{ u: 60000, c: 10, t: 600000, n: 'm' },
				{ u: 60000, c: 15, t: 900000, n: 'm' },
				{ u: 60000, c: 20, t: 1200000, n: 'm' },
				{ u: 60000, c: 30, t: 1800000, n: 'm' },
				{ u: 3600000, c: 1, t: 3600000, n: 'h' },
				{ u: 3600000, c: 2, t: 7200000, n: 'h' },
				{ u: 3600000, c: 3, t: 10800000, n: 'h' },
				{ u: 3600000, c: 4, t: 14400000, n: 'h' },
				{ u: 3600000, c: 6, t: 21600000, n: 'h' },
				{ u: 3600000, c: 8, t: 28800000, n: 'h' },
				{ u: 3600000, c: 12, t: 43200000, n: 'h' },
				{ u: 86400000, c: 1, t: 86400000, n: 'd' },
				{ u: 86400000, c: 2, t: 172800000, n: 'd' },
				{ u: 86400000, c: 4, t: 345600000, n: 'd' },
				{ u: 86400000, c: 5, t: 432000000, n: 'd' },
				{ u: 604800000, c: 1, t: 604800000, n: 'w' }];

			var mul = 2;

			var minSteps = 2;
			var maxSteps = drawingSize / (fontSize * mul);

			var valueRange = +valueMax - valueMin,
				offset = new Date(+valueMin).getTimezoneOffset() * 60000,
				min = +valueMin + offset,
				max = +valueMax + offset;

			var xp = 0;

			while (xp < units.length && (valueRange / units[xp].t > maxSteps)) {
				xp++;
			}

			var stepValue = units[xp].t,
				start = Math.floor(min / stepValue) * stepValue,
				stepCount = Math.ceil((max - start) / stepValue),
				end = start + stepValue * stepCount;

			return {
				start: start - offset,
				end: end - offset,
				stepValue: stepValue,
				stepCount: stepCount
			};
		}

	</script>

</body>
</html>
